{"ts":1354607147879,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1354607691720,"patch":[[{"diffs":[[1,"var Db = require('mongodb').Db;\r\nvar Connection = require('mongodb').Connection;\r\nvar Server = require('mongodb').Server;\r\nvar BSON = require('mongodb').BSON;\r\nvar ObjectID = require('mongodb').ObjectID;\r\nvar GridStore = require('mongodb').GridStore;\r\n\r\nImageFileProvider = function (dburl) {\r\n    this.db = new Db(dburl);\r\n};\r\n\r\nImageFileProvider.prototype.insert = function (data, callback) {\r\n    //process.nextTick(function(){\r\n        var gridStore = new GridStore(this.db, new ObjectID(), 'w', {\"content_type\":\"image/png\",\"chunk_size\":data.length});\r\n        gridStore.open(function (err, gridStore) {\r\n            gridStore.write(data, function () {\r\n                gridStore.close(function (err, result) {\r\n                    if (err) {\r\n                        console.log(err);\r\n                    } else {\r\n                        console.log('insert ok.');\r\n                        callback(result);\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    //});\r\n};\r\n\r\nImageFileProvider.prototype.read = function (fileId, callback) {\r\n    console.log('read ...'+fileId);\r\n    var gridStore = new GridStore(this.db, new ObjectID(fileId));\r\n    console.log('gridStore ...'+gridStore);\r\n    gridStore.open(function (err, gridStore) {\r\n        if(err){\r\n            console.log(err);\r\n        }else{\r\n            console.log('open ...');\r\n            gridStore.read(function (err, data) {\r\n                if (err) {\r\n                    console.log(err);\r\n                } else {\r\n                    console.log('read ok');\r\n                    callback(data);\r\n                }\r\n            });\r\n        }\r\n    });\r\n};\r\n\r\nexports.ImageFileProvider = ImageFileProvider;"]],"start1":0,"start2":0,"length1":0,"length2":1707}]],"length":1707,"saved":false}
{"ts":1354607902092,"patch":[[{"diffs":[[0,"idStore;\r\n\r\n"],[1,"var "],[0,"ImageFilePro"]],"start1":242,"start2":242,"length1":24,"length2":28}]],"length":1711,"saved":false}
