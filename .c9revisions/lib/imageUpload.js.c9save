{"ts":1354607147879,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1354607691720,"patch":[[{"diffs":[[1,"var Db = require('mongodb').Db;\r\nvar Connection = require('mongodb').Connection;\r\nvar Server = require('mongodb').Server;\r\nvar BSON = require('mongodb').BSON;\r\nvar ObjectID = require('mongodb').ObjectID;\r\nvar GridStore = require('mongodb').GridStore;\r\n\r\nImageFileProvider = function (dburl) {\r\n    this.db = new Db(dburl);\r\n};\r\n\r\nImageFileProvider.prototype.insert = function (data, callback) {\r\n    //process.nextTick(function(){\r\n        var gridStore = new GridStore(this.db, new ObjectID(), 'w', {\"content_type\":\"image/png\",\"chunk_size\":data.length});\r\n        gridStore.open(function (err, gridStore) {\r\n            gridStore.write(data, function () {\r\n                gridStore.close(function (err, result) {\r\n                    if (err) {\r\n                        console.log(err);\r\n                    } else {\r\n                        console.log('insert ok.');\r\n                        callback(result);\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    //});\r\n};\r\n\r\nImageFileProvider.prototype.read = function (fileId, callback) {\r\n    console.log('read ...'+fileId);\r\n    var gridStore = new GridStore(this.db, new ObjectID(fileId));\r\n    console.log('gridStore ...'+gridStore);\r\n    gridStore.open(function (err, gridStore) {\r\n        if(err){\r\n            console.log(err);\r\n        }else{\r\n            console.log('open ...');\r\n            gridStore.read(function (err, data) {\r\n                if (err) {\r\n                    console.log(err);\r\n                } else {\r\n                    console.log('read ok');\r\n                    callback(data);\r\n                }\r\n            });\r\n        }\r\n    });\r\n};\r\n\r\nexports.ImageFileProvider = ImageFileProvider;"]],"start1":0,"start2":0,"length1":0,"length2":1707}]],"length":1707,"saved":false}
{"ts":1354607902092,"patch":[[{"diffs":[[0,"idStore;\r\n\r\n"],[1,"var "],[0,"ImageFilePro"]],"start1":242,"start2":242,"length1":24,"length2":28}]],"length":1711,"saved":false}
{"contributors":[],"silentsave":false,"ts":1354612978466,"patch":[[{"diffs":[[0,"var "],[-1,"Db"],[1,"mongoose"],[0," = requi"]],"start1":0,"start2":0,"length1":14,"length2":20},{"diffs":[[0,"ire("],[-1,"'mongodb').Db;\r\nvar"],[1,"\"mongoose\")\r\n,mongodb = mongoose.mongo\r\nvar Db = mongodb.Db\r\n,  "],[0," Con"]],"start1":19,"start2":19,"length1":27,"length2":72},{"diffs":[[0,"ction = "],[-1,"require('"],[0,"mongodb"],[-1,"')"],[0,".Connect"]],"start1":93,"start2":93,"length1":34,"length2":23},{"diffs":[[0,"nnection"],[-1,";"],[0,"\r\n"],[-1,"var"],[1,",  "],[0," Server "]],"start1":111,"start2":111,"length1":22,"length2":21},{"diffs":[[0,"r = "],[-1,"require('"],[0,"mongodb"],[-1,"')"],[0,".Server"],[-1,";"],[0,"\r\n"],[-1,"var"],[1,",  "],[0," BSON = "],[-1,"require('"],[0,"mongodb"],[-1,"')"],[0,".BSON"],[-1,";"],[0,"\r\n"],[-1,"var"],[1,",  "],[0," Obj"]],"start1":130,"start2":130,"length1":76,"length2":52},{"diffs":[[0,"ectID = "],[-1,"require('"],[0,"mongodb"],[-1,"')"],[0,".ObjectI"]],"start1":182,"start2":182,"length1":34,"length2":23},{"diffs":[[0,"ctID"],[-1,";"],[0,"\r\n"],[-1,"var"],[1,",  "],[0," Gri"]],"start1":202,"start2":202,"length1":14,"length2":13},{"diffs":[[0,"e = "],[-1,"require('"],[0,"mongodb"],[-1,"')"],[0,".Gri"]],"start1":220,"start2":220,"length1":26,"length2":15},{"diffs":[[0,"ridStore"],[-1,";"],[1,"\r\n\r\nvar host = \"127.0.0.1\"\r\n,   port = 27017\r\n,   db = \"iroundu\""],[0,"\r\n\r\nvar "]],"start1":233,"start2":233,"length1":17,"length2":80},{"diffs":[[0,"ar Image"],[-1,"FileProvider"],[1,"Upload"],[0," = funct"]],"start1":310,"start2":310,"length1":28,"length2":22},{"diffs":[[0,"nction ("],[-1,"dburl"],[0,") {\r\n   "]],"start1":329,"start2":329,"length1":21,"length2":16},{"diffs":[[0," Db("],[-1,"dburl);\r\n};\r\n\r\nImageFileProvider"],[1,"this.db, new Server(this.host, this.port, {auto_reconnect:true}, {}));\r\n};\r\n\r\nImageUpload.prototype.setup = function(host,port,db){\r\n    this.host = host\r\n    this.port = port\r\n    this.db = db\r\n}\r\n\r\nImageUpload"],[0,".pro"]],"start1":359,"start2":359,"length1":40,"length2":219},{"diffs":[[0,"age/"],[1,"j"],[0,"p"],[-1,"n"],[0,"g\",\""]],"start1":746,"start2":746,"length1":10,"length2":10},{"diffs":[[0,"\n\r\nImage"],[-1,"FileProvider"],[1,"Upload"],[0,".prototy"]],"start1":1231,"start2":1231,"length1":28,"length2":22},{"diffs":[[0,"mage"],[-1,"FileProvider = ImageFileProvider"],[1,"Upload = ImageUpload"],[0,";"]],"start1":1891,"start2":1891,"length1":37,"length2":25}]],"length":1916,"saved":false}
{"ts":1354613235392,"patch":[[{"diffs":[[0,"ction () {\r\n"],[1,"    console.log(this.db)\r\n"],[0,"    this.db "]],"start1":330,"start2":330,"length1":24,"length2":50}]],"length":1942,"saved":false}
{"ts":1354613348789,"patch":[[{"diffs":[[0,"tore\r\n\r\n"],[-1,"var "],[1,"this."],[0,"host = \""]],"start1":237,"start2":237,"length1":20,"length2":21},{"diffs":[[0,"1\"\r\n,   "],[1,"this."],[0,"port = 2"]],"start1":266,"start2":266,"length1":16,"length2":21},{"diffs":[[0,"17\r\n,   "],[1,"this."],[0,"db = \"ir"]],"start1":289,"start2":289,"length1":16,"length2":21}]],"length":1953,"saved":false}
{"ts":1354613431130,"patch":[[{"diffs":[[0,"\r\n\r\n"],[-1,"this.host = \"127.0.0.1\"\r\n,   this.port = 27017\r\n,   this.db = \"iroundu\"\r\n"],[0,"\r\nva"]],"start1":241,"start2":241,"length1":81,"length2":8},{"diffs":[[0," new Db("],[-1,"this.db"],[1,"'iroundu'"],[0,", new Se"]],"start1":319,"start2":319,"length1":23,"length2":25},{"diffs":[[0,"ver("],[-1,"this."],[1,"\"local"],[0,"host"],[1,"\""],[0,", "],[-1,"this.port"],[1,"27017"],[0,", {a"]],"start1":345,"start2":345,"length1":28,"length2":26},{"diffs":[[0,"\r\n\r\n"],[-1,"ImageUpload.prototype.setup = function(host,port,db){\r\n    this.host = host\r\n    this.port = port\r\n    this.db = db\r\n}\r\n\r\n"],[0,"Imag"]],"start1":401,"start2":401,"length1":130,"length2":8}]],"length":1758,"saved":false}
{"ts":1354613482332,"patch":[[{"diffs":[[0," {\r\n"],[-1,"    console.log(this.db)\r\n"],[0,"    "]],"start1":276,"start2":276,"length1":34,"length2":8}]],"length":1732,"saved":false}
{"contributors":[],"silentsave":false,"ts":1354616502455,"patch":[[{"diffs":[[0,"pe\":"],[-1,"\"image/jpg\""],[1,"data.type"],[0,",\"ch"]],"start1":555,"start2":555,"length1":19,"length2":17},{"diffs":[[0," {\r\n"],[-1,"    console.log('read ...'+fileId);\r\n"],[0,"    "]],"start1":1104,"start2":1104,"length1":45,"length2":8},{"diffs":[[0,");\r\n"],[-1,"    console.log('gridStore ...'+gridStore);\r\n"],[0,"    "]],"start1":1171,"start2":1171,"length1":53,"length2":8},{"diffs":[[0,"e{\r\n"],[-1,"            console.log('open ...');\r\n"],[0,"    "]],"start1":1284,"start2":1284,"length1":46,"length2":8},{"diffs":[[0,"sole.log(err);\r\n"],[1,""],[0,"                "]],"start1":1390,"start2":1390,"length1":32,"length2":32},{"diffs":[[0," {\r\n"],[-1,"                    console.log('read ok');\r\n"],[0,"    "]],"start1":1428,"start2":1428,"length1":53,"length2":8}]],"length":1565,"saved":false}
{"ts":1354620194139,"patch":[[{"diffs":[[0," {\r\n"],[-1,"                        console.log('insert ok.');\r\n"],[0,"    "]],"start1":858,"start2":858,"length1":60,"length2":8}]],"length":1513,"saved":false}
